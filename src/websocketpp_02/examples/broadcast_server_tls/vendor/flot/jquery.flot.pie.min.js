(function(b){function c(d){var h=null;var l=null;var n=null;var b=null;var p=null;var m=0;var f=true;var o=10;var w=0.95;var a=0;var d=false;var z=false;var j=[];d.hooks.processoptions.push(g);d.hooks.bindevents.push(e);function g(o,n){if(n.series.pie.show){n.grid.show=false;if(n.series.pie.label.show=="auto"){if(n.legend.show){n.series.pie.label.show=false}else{n.series.pie.label.show=true}}if(n.series.pie.radius=="auto"){if(n.series.pie.label.show){n.series.pie.radius=3/4}else{n.series.pie.radius=1}}if(n.series.pie.tilt>1){n.series.pie.tilt=1}if(n.series.pie.tilt<0){n.series.pie.tilt=0}o.hooks.processdatapoints.push(e);o.hooks.drawoverlay.push(h);o.hooks.draw.push(r)}}function e(p,n){var o=p.getoptions();if(o.series.pie.show&&o.grid.hoverable){n.unbind("mousemove").mousemove(t)}if(o.series.pie.show&&o.grid.clickable){n.unbind("click").click(l)}}function g(o){var p="";function n(s,t){if(!t){t=0}for(var r=0;r<s.length;++r){for(var q=0;q<t;q++){p+="\t"}if(typeof s[r]=="object"){p+=""+r+":\n";n(s[r],t+1)}else{p+=""+r+": "+s[r]+"\n"}}}n(o);alert(p)}function q(p){for(var n=0;n<p.length;++n){var o=parsefloat(p[n].data[0][1]);if(o){m+=o}}}function e(q,n,o,p){if(!d){d=true;h=q.getcanvas();l=b(h).parent();a=q.getoptions();q.setdata(k(q.getdata()))}}function i(){a=l.children().filter(".legend").children().width();n=math.min(h.width,(h.height/a.series.pie.tilt))/2;p=(h.height/2)+a.series.pie.offset.top;b=(h.width/2);if(a.series.pie.offset.left=="auto"){if(a.legend.position.match("w")){b+=a/2}else{b-=a/2}}else{b+=a.series.pie.offset.left}if(b<n){b=n}else{if(b>h.width-n){b=h.width-n}}}function v(o){for(var n=0;n<o.length;++n){if(typeof(o[n].data)=="number"){o[n].data=[[1,o[n].data]]}else{if(typeof(o[n].data)=="undefined"||typeof(o[n].data[0])=="undefined"){if(typeof(o[n].data)!="undefined"&&typeof(o[n].data.label)!="undefined"){o[n].label=o[n].data.label}o[n].data=[[1,0]]}}}return o}function k(q){q=v(q);q(q);var p=0;var s=0;var n=a.series.pie.combine.color;var r=[];for(var o=0;o<q.length;++o){q[o].data[0][1]=parsefloat(q[o].data[0][1]);if(!q[o].data[0][1]){q[o].data[0][1]=0}if(q[o].data[0][1]/m<=a.series.pie.combine.threshold){p+=q[o].data[0][1];s++;if(!n){n=q[o].color}}else{r.push({data:[[1,q[o].data[0][1]]],color:q[o].color,label:q[o].label,angle:(q[o].data[0][1]*(math.pi*2))/m,percent:(q[o].data[0][1]/m*100)})}}if(s>0){r.push({data:[[1,p]],color:n,label:a.series.pie.combine.label,angle:(p*(math.pi*2))/m,percent:(p/m*100)})}return r}function r(s,q){if(!l){return}ctx=q;i();var t=s.getdata();var p=0;while(f&&p<o){f=false;if(p>0){n*=w}p+=1;n();if(a.series.pie.tilt<=0.8){o()}r()}if(p>=o){n();l.prepend('<div class="error">could not draw pie with labels contained inside canvas</div>')}if(s.setseries&&s.insertlegend){s.setseries(t);s.insertlegend()}function n(){ctx.clearrect(0,0,h.width,h.height);l.children().filter(".pielabel, .pielabelbackground").remove()}function o(){var z=5;var y=15;var w=10;var x=0.02;if(a.series.pie.radius>1){var u=a.series.pie.radius}else{var u=n*a.series.pie.radius}if(u>=(h.width/2)-z||u*a.series.pie.tilt>=(h.height/2)-y||u<=w){return}ctx.save();ctx.translate(z,y);ctx.globalalpha=x;ctx.fillstyle="#000";ctx.translate(b,p);ctx.scale(1,a.series.pie.tilt);for(var v=1;v<=w;v++){ctx.beginpath();ctx.arc(0,0,u,0,math.pi*2,false);ctx.fill();u-=v}ctx.restore()}function r(){startangle=math.pi*a.series.pie.startangle;if(a.series.pie.radius>1){var u=a.series.pie.radius}else{var u=n*a.series.pie.radius}ctx.save();ctx.translate(b,p);ctx.scale(1,a.series.pie.tilt);ctx.save();var y=startangle;for(var w=0;w<t.length;++w){t[w].startangle=y;x(t[w].angle,t[w].color,true)}ctx.restore();ctx.save();ctx.linewidth=a.series.pie.stroke.width;y=startangle;for(var w=0;w<t.length;++w){x(t[w].angle,a.series.pie.stroke.color,false)}ctx.restore();j(ctx);if(a.series.pie.label.show){v()}ctx.restore();function x(ab,z,aa){if(ab<=0){return}if(aa){ctx.fillstyle=z}else{ctx.strokestyle=z;ctx.linejoin="round"}ctx.beginpath();if(math.abs(ab-math.pi*2)>1e-9){ctx.moveto(0,0)}else{if(b.browser.msie){ab-=0.0001}}ctx.arc(0,0,u,y,y+ab,false);ctx.closepath();y+=ab;if(aa){ctx.fill()}else{ctx.stroke()}}function v(){var ac=startangle;if(a.series.pie.label.radius>1){var z=a.series.pie.label.radius}else{var z=n*a.series.pie.label.radius}for(var ab=0;ab<t.length;++ab){if(t[ab].percent>=a.series.pie.label.threshold*100){aa(t[ab],ac,ab)}ac+=t[ab].angle}function aa(ap,ai,ag){if(ap.data[0][1]==0){return}var ar=a.legend.labelformatter,aq,ae=a.series.pie.label.formatter;if(ar){aq=ar(ap.label,ap)}else{aq=ap.label}if(ae){aq=ae(aq,ap)}var aj=((ai+ap.angle)+ai)/2;var ao=b+math.round(math.cos(aj)*z);var am=p+math.round(math.sin(aj)*z)*a.series.pie.tilt;var af='<span class="pielabel" id="pielabel'+ag+'" style="position:absolute;top:'+am+"px;left:"+ao+'px;">'+aq+"</span>";l.append(af);var an=l.children("#pielabel"+ag);var ad=(am-an.height()/2);var ah=(ao-an.width()/2);an.css("top",ad);an.css("left",ah);if(0-ad>0||0-ah>0||h.height-(ad+an.height())<0||h.width-(ah+an.width())<0){f=true}if(a.series.pie.label.background.opacity!=0){var ak=a.series.pie.label.background.color;if(ak==null){ak=ap.color}var al="top:"+ad+"px;left:"+ah+"px;";b('<div class="pielabelbackground" style="position:absolute;width:'+an.width()+"px;height:"+an.height()+"px;"+al+"background-color:"+ak+';"> </div>').insertbefore(an).css("opacity",a.series.pie.label.background.opacity)}}}}}function j(n){if(a.series.pie.innerradius>0){n.save();innerradius=a.series.pie.innerradius>1?a.series.pie.innerradius:n*a.series.pie.innerradius;n.globalcompositeoperation="destination-out";n.beginpath();n.fillstyle=a.series.pie.stroke.color;n.arc(0,0,innerradius,0,math.pi*2,false);n.fill();n.closepath();n.restore();n.save();n.beginpath();n.strokestyle=a.series.pie.stroke.color;n.arc(0,0,innerradius,0,math.pi*2,false);n.stroke();n.closepath();n.restore()}}function s(q,r){for(var s=false,p=-1,n=q.length,o=n-1;++p<n;o=p){((q[p][1]<=r[1]&&r[1]<q[o][1])||(q[o][1]<=r[1]&&r[1]<q[p][1]))&&(r[0]<(q[o][0]-q[p][0])*(r[1]-q[p][1])/(q[o][1]-q[p][1])+q[p][0])&&(s=!s)}return s}function u(r,p){var t=d.getdata(),o=d.getoptions(),n=o.series.pie.radius>1?o.series.pie.radius:n*o.series.pie.radius;for(var q=0;q<t.length;++q){var s=t[q];if(s.pie.show){ctx.save();ctx.beginpath();ctx.moveto(0,0);ctx.arc(0,0,n,s.startangle,s.startangle+s.angle,false);ctx.closepath();x=r-b;y=p-p;if(ctx.ispointinpath){if(ctx.ispointinpath(r-b,p-p)){ctx.restore();return{datapoint:[s.percent,s.data],dataindex:0,series:s,seriesindex:q}}}else{p1x=(n*math.cos(s.startangle));p1y=(n*math.sin(s.startangle));p2x=(n*math.cos(s.startangle+(s.angle/4)));p2y=(n*math.sin(s.startangle+(s.angle/4)));p3x=(n*math.cos(s.startangle+(s.angle/2)));p3y=(n*math.sin(s.startangle+(s.angle/2)));p4x=(n*math.cos(s.startangle+(s.angle/1.5)));p4y=(n*math.sin(s.startangle+(s.angle/1.5)));p5x=(n*math.cos(s.startangle+s.angle));p5y=(n*math.sin(s.startangle+s.angle));arrpoly=[[0,0],[p1x,p1y],[p2x,p2y],[p3x,p3y],[p4x,p4y],[p5x,p5y]];arrpoint=[x,y];if(s(arrpoly,arrpoint)){ctx.restore();return{datapoint:[s.percent,s.data],dataindex:0,series:s,seriesindex:q}}}ctx.restore()}}return null}function t(n){m("plothover",n)}function l(n){m("plotclick",n)}function m(n,t){var o=d.offset(),r=parseint(t.pagex-o.left),p=parseint(t.pagey-o.top),v=u(r,p);if(a.grid.autohighlight){for(var q=0;q<j.length;++q){var s=j[q];if(s.auto==n&&!(v&&s.series==v.series)){f(s.series)}}}if(v){k(v.series,n)}var u={pagex:t.pagex,pagey:t.pagey};l.trigger(n,[u,v])}function k(o,p){if(typeof o=="number"){o=series[o]}var n=c(o);if(n==-1){j.push({series:o,auto:p});d.triggerredrawoverlay()}else{if(!p){j[n].auto=false}}}function f(o){if(o==null){j=[];d.triggerredrawoverlay()}if(typeof o=="number"){o=series[o]}var n=c(o);if(n!=-1){j.splice(n,1);d.triggerredrawoverlay()}}function c(p){for(var n=0;n<j.length;++n){var o=j[n];if(o.series==p){return n}}return -1}function h(q,r){var p=q.getoptions();var n=p.series.pie.radius>1?p.series.pie.radius:n*p.series.pie.radius;r.save();r.translate(b,p);r.scale(1,p.series.pie.tilt);for(i=0;i<j.length;++i){o(j[i].series)}j(r);r.restore();function o(s){if(s.angle<0){return}r.fillstyle="rgba(255, 255, 255, "+p.series.pie.highlight.opacity+")";r.beginpath();if(math.abs(s.angle-math.pi*2)>1e-9){r.moveto(0,0)}r.arc(0,0,n,s.startangle,s.startangle+s.angle,false);r.closepath();r.fill()}}}var a={series:{pie:{show:false,radius:"auto",innerradius:0,startangle:3/2,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(d,e){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+e.color+';">'+d+"<br/>"+math.round(e.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"other"},highlight:{opacity:0.5}}}};b.plot.plugins.push({init:c,options:a,name:"pie",version:"1.0"})})(jquery);